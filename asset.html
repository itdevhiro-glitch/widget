<!DOCTYPE html>

<html lang="id">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>Zeppelin ‚Äî Asset Manager (Fixed)</title>
<meta content="Bima Adhitya" name="author"/>
<meta content="Asset Manager &amp; QC ‚Äî Zeppelin. Local-only. Export XLSX/JSON. Dashboard statistik." name="description"/>
<style>
:root {
  --bg: #0e1117;
  --card: #161b22;
  --muted: #9ca3af;
  --accent: #ff7a18;
  --border: rgba(255, 255, 255, 0.06);
  --success: #1db954;
  --error: #ff4d4f;
  --shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
}
* { box-sizing: border-box; font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial; }
html, body { margin:0; padding:0; height:100%; width:100%; background-color:var(--bg); color:#e6eef6; overflow-x:hidden; }
.wrap { width:100%; max-width:1600px; margin:0 auto; padding:clamp(16px,2vw,32px); }
header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px;margin-bottom:24px}
.brand{display:flex;align-items:center;gap:14px}
.logo-img,.logo-placeholder{width:52px;height:52px;border-radius:12px;object-fit:cover}
.logo-placeholder{background:linear-gradient(135deg,var(--accent),#ffb24d);display:flex;align-items:center;justify-content:center;font-weight:800;color:#08101a}
h1{font-size:clamp(18px,1.8vw,22px);margin:0}
.sub{font-size:clamp(12px,1vw,14px);color:var(--muted)}
.controls{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.btn{background:var(--accent);border:none;padding:8px 14px;border-radius:8px;color:#08101a;font-weight:600;cursor:pointer;transition:all .2s ease;box-shadow:var(--shadow)}
.btn:hover{opacity:.9;transform:translateY(-1px)}
.btn-ghost{background:transparent;border:1px solid var(--border);color:var(--muted);border-radius:8px;padding:8px 12px;cursor:pointer;transition:.2s}
.btn-ghost:hover{border-color:var(--accent);color:#fff}
.search{padding:8px 12px;border-radius:8px;border:1px solid var(--border);background:#1b222e;color:#fff;min-width:200px}
.grid{display:grid;grid-template-columns:380px 1fr;gap:24px}
@media (max-width:1100px){ .grid{grid-template-columns:1fr} }
.card{background:var(--card);border-radius:12px;padding:16px 20px;border:1px solid var(--border);box-shadow:var(--shadow)}
.kpi-row{display:flex;gap:16px;flex-wrap:wrap;margin-top:16px}
.kpi{flex:1;min-width:180px;background:#1a2233;padding:12px;border-radius:10px;border:1px solid var(--border);text-align:center}
table{width:100%;border-collapse:collapse;margin-top:12px;font-size:14px}
th,td{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,0.05)}
th{color:var(--muted);font-weight:600;text-transform:uppercase;font-size:12px}
.table-wrap{overflow-y:auto;overflow-x:hidden;max-height:450px}
label{display:block;font-size:13px;color:var(--muted);margin-top:10px}
input,select,textarea{width:100%;background:#1b222e;border:1px solid var(--border);color:#fff;border-radius:8px;padding:8px 10px;font-size:14px}
textarea{min-height:70px}
footer{margin-top:32px;text-align:center;color:var(--muted);font-size:13px;padding:16px 0}
mark{background:rgba(255,235,59,0.25);padding:0 2px;border-radius:2px}
</style>
</head>
<body>
<div class="wrap">
<header>
<div class="brand">
<div id="logoWrap">
<img alt="Zeppelin Logo" class="logo-img" onerror="this.style.display='none';document.getElementById('logoFallback').style.display='flex'" src="asset.png"/>
<div class="logo-placeholder" id="logoFallback" style="display:none">Z</div>
</div>
<div>
<h1>Zeppelin ‚Äî Asset Manager</h1>
<div class="sub">QC &amp; Inventory ‚Ä¢ Local backup ‚Ä¢ Export XLSX/JSON ‚Ä¢ Developed by Bima Adhitya</div>
</div>
</div>
<div class="controls no-print">
<input aria-label="Cari asset" class="search" id="globalSearch" placeholder="Cari: jenis, brand, serial, PIC..."/>
<button class="btn" id="downloadExcelBtn">Download Excel</button>
<button class="btn-ghost" id="backupBtn">Backup JSON</button>
<button class="btn-ghost" id="restoreBtn">Restore JSON</button>
<button class="btn-ghost" id="printBtn">Print / PDF</button>
<input accept="application/json, .json, .csv" id="fileInput" style="display:none" type="file"/>
<div id="filterControls" style="display:flex;gap:8px;align-items:center;">
<select class="search" id="filterType" title="Filter by jenis"><option value="">All Jenis</option></select>
<select class="search" id="filterQc" title="Filter by QC"><option value="">All QC</option><option value="Belum QC">Belum QC</option><option value="Lulus QC">Lulus QC</option><option value="Gagal QC">Gagal QC</option></select>
<select class="search" id="filterLoc" title="Filter by Lokasi"><option value="">All Lokasi</option></select>
<select class="search" id="filterPic" title="Filter by PIC"><option value="">All PIC</option></select>
<button class="btn-ghost" id="themeToggle" style="min-width:40px">Theme</button>
<button class="btn-ghost" id="restoreBackupBtn" title="Restore last backup">Restore</button>
<button class="btn" id="printReportBtn" title="Cetak laporan PDF">Cetak Laporan (PDF)</button>
</div>
</div>
</header>
<section class="card">
<div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
<div>
<h2 style="margin:0;color:var(--accent)">Dashboard Statistik Asset IT</h2>
<div class="muted">Ringkasan cepat &amp; grafik interaktif.</div>
</div>
</div>
<div class="kpi-row" style="margin-top:12px">
<div class="kpi"><div id="kpiTotal" style="font-size:18px;font-weight:800">0</div><div class="muted">Total Asset</div></div>
<div class="kpi"><div id="kpiPC" style="font-size:18px;font-weight:800">0</div><div class="muted">Total Laptop &amp; Desktop</div></div>
<div class="kpi"><div id="kpiQC" style="font-size:14px;font-weight:700">L:0 ‚Ä¢ G:0 ‚Ä¢ B:0</div><div class="muted">Status QC</div></div>
</div>
<div style="display:flex;gap:12px;flex-wrap:wrap">
<div style="flex:1;min-width:420px">
<canvas aria-label="Chart kategori" height="140" id="barCategories"></canvas>
</div>
<div style="width:320px">
<canvas aria-label="Chart QC" height="140" id="pieQc"></canvas>
</div>
</div>
</section>
<div class="grid" style="margin-top:12px">
<aside class="card">
<h3>Tambah / Edit Asset</h3>
<div class="muted">Isi detail asset ‚Äî warranty &amp; tgl pembelian opsional.</div>
<label>Nama Barang</label>
<input id="name" placeholder="Contoh: Laptop Dell Latitude"/>
<label>Jenis</label>
<select id="itemType">
<option>Laptop</option>
<option>Desktop</option>
<option>Monitor</option>
<option>Keyboard</option>
<option>Mouse</option>
<option>SATA Cable</option>
<option>LAN Cable</option>
<option>Power Cable</option>
<option>UPS</option>
<option>SSD</option>
<option>HDD</option>
<option>Other</option>
</select>
<label>Serial / Tag ID</label>
<input id="serial" placeholder="SN atau Tag ID (opsional)"/>
<label>Qty</label>
<input id="qty" min="1" type="number" value="1"/>
<label>Status QC</label>
<select id="qcStatus"><option>Belum QC</option><option>Lulus QC</option><option>Gagal QC</option></select>
<label>Software Terinstal (pisahkan koma)</label>
<input id="software" placeholder="Contoh: Radmin, VNC, Accurate"/>
<label>Lokasi</label>
<input id="location" placeholder="Ruang / Rack / Gudang"/>
<label>PIC</label>
<input id="pic" placeholder="Penanggung jawab / Nama"/>
<label>Tanggal Pembelian (opsional)</label>
<input id="purchaseDate" type="date"/>
<label>Warranty Until (opsional)</label>
<input id="warrantyUntil" type="date"/>
<label>Keterangan</label>
<textarea id="notes" placeholder="Catatan tambahan, kondisi fisik, license keys..."></textarea>
<div style="display:flex;gap:8px;margin-top:10px">
<button class="btn" id="addBtn">Tambah Item</button>
<button class="btn-ghost" id="updateBtn" style="width:auto">Clear / Reset</button>
</div>
</aside>
<main>
<div class="card">
<div style="display:flex;justify-content:space-between;align-items:center">
<div>
<h3>Daftar Asset</h3>
<div class="muted">Klik Edit untuk update. Export CSV/JSON tersedia.</div>
</div>
<div class="muted">Total: <span id="totalCount">0</span></div>
</div>
<div class="table-wrap">
<table id="assetTable">
<thead>
<tr><th>ID</th><th>Nama</th><th>Jenis</th><th>Serial</th><th>Qty</th><th>Software</th><th>PIC</th><th>Lokasi</th><th>Purchase</th><th>Warranty</th><th>QC</th><th>Actions</th></tr>
</thead>
<tbody></tbody>
</table>
</div>
</div>
<div style="height:14px"></div>
<div class="card">
<h3>QC Checklist (Laptop &amp; Desktop)</h3>
<div class="muted">Centang item yang OK. Simpan QC ke asset tertentu.</div>
<div id="qcList" style="margin-top:10px;display:grid;grid-template-columns:1fr 1fr;gap:6px"></div>
<div style="display:flex;gap:8px;margin-top:12px">
<input id="qcTargetId" placeholder="Masukkan Asset ID untuk simpan QC"/>
<button class="btn" id="saveQcBtn">Simpan QC</button>
<button class="btn-ghost" id="clearQcBtn">Reset</button>
</div>
</div>
<div style="height:14px"></div>
<div class="card no-print">
<h3>Export &amp; Import</h3>
<div class="muted">Export CSV untuk Excel; JSON untuk backup &amp; restore.</div>
<div style="display:flex;gap:8px;margin-top:10px">
<button class="btn" id="exportCsvBtn">Export CSV</button>
<button class="btn-ghost" id="exportJsonBtn">Export JSON</button>
<button class="btn-ghost" id="importCsvBtn">Import CSV</button>
<button class="btn-ghost" id="importJsonBtn">Import JSON</button>
<input accept="text/csv" id="csvFile" style="display:none" type="file"/>
<input accept="application/json" id="jsonFile" style="display:none" type="file"/>
</div>
</div>
</main>
</div>
<footer>¬© 2025 Zeppelin | Developed by Bima Adhitya</footer>
</div>
<!-- CDN (graceful fallback if blocked) -->
<script crossorigin="anonymous" integrity="" src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script crossorigin="anonymous" integrity="" src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script>
/* Central constants and small helpers */
(function(){
  const STORAGE_KEY = 'asset_manager_final';
  window.ASSET_STORAGE_KEY = STORAGE_KEY; // expose for other scripts

  // small utility to debounce frequent input events
  function debounce(fn, ms){ let t; return function(){ clearTimeout(t); t=setTimeout(()=>fn.apply(this,arguments), ms||200); }; }

  // expose a safe escape helper
  window.escapeHtml = function(s){ if(s==null) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); };

  // The main app is exposed as window.ZeppelinApp for debugging if needed
  const ZeppelinApp = (function(){
    let db = { assets: [] };
    const qcTemplate = [
      {k:'power', l:'Power on / Battery'}, {k:'screen', l:'Screen / Dead pixel'}, {k:'keyboard', l:'Keyboard / Touchpad'},
      {k:'ram', l:'RAM capacity / detecting'}, {k:'storage', l:'Storage health / SMART'}, {k:'network', l:'Network adapter / Wi-Fi'},
      {k:'gpu', l:'GPU / Display adapter'}, {k:'bios', l:'BIOS / Boot'}, {k:'os', l:'OS installed / activation'},
      {k:'drivers', l:'Drivers up-to-date'}, {k:'antivirus', l:'Antivirus status / Whitelisted'}, {k:'vpn', l:'VPN (Radmin/VNC) installed'},
      {k:'accurate', l:'Accurate / License'}
    ];

    // elements cached
    const tbody = document.querySelector('#assetTable tbody');
    const totalCountEl = document.getElementById('totalCount');
    const kpiTotal = document.getElementById('kpiTotal');
    const kpiPC = document.getElementById('kpiPC');
    const kpiQC = document.getElementById('kpiQC');
    const barCanvas = document.getElementById('barCategories');
    const pieCanvas = document.getElementById('pieQc');

    const nameEl = document.getElementById('name');
    const typeEl = document.getElementById('itemType');
    const serialEl = document.getElementById('serial');
    const qtyEl = document.getElementById('qty');
    const qcStatusEl = document.getElementById('qcStatus');
    const softwareEl = document.getElementById('software');
    const locEl = document.getElementById('location');
    const picEl = document.getElementById('pic');
    const purchaseEl = document.getElementById('purchaseDate');
    const warrantyEl = document.getElementById('warrantyUntil');
    const notesEl = document.getElementById('notes');

    const addBtn = document.getElementById('addBtn');
    const updateBtn = document.getElementById('updateBtn');
    const exportCsvBtn = document.getElementById('exportCsvBtn');
    const exportJsonBtn = document.getElementById('exportJsonBtn');
    const importCsvBtn = document.getElementById('importCsvBtn');
    const importJsonBtn = document.getElementById('importJsonBtn');
    const csvFile = document.getElementById('csvFile');
    const jsonFile = document.getElementById('jsonFile');
    const backupBtn = document.getElementById('backupBtn');
    const restoreBtn = document.getElementById('restoreBtn');
    const fileInput = document.getElementById('fileInput');
    const globalSearch = document.getElementById('globalSearch');

    let editId = null; let barChart=null, pieChart=null;

    function load(){ try{ const raw = localStorage.getItem(STORAGE_KEY); if(!raw){ db = { assets: [] }; save(false); } else db = JSON.parse(raw); }catch(e){ db = { assets: [] }; save(false); } }
    function save(shouldRender=true){ localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); if(shouldRender) { render(); updateDashboard(); } }

    function genId(){ return 'id-'+Date.now().toString(36)+'-'+Math.floor(Math.random()*9999); }
    function clearForm(){ editId=null; nameEl.value=''; typeEl.selectedIndex=0; serialEl.value=''; qtyEl.value=1; qcStatusEl.selectedIndex=0; softwareEl.value=''; locEl.value=''; picEl.value=''; purchaseEl.value=''; warrantyEl.value=''; notesEl.value=''; addBtn.disabled=false; updateBtn.textContent='Clear / Reset'; }

    // Robust render: create elements and attach data-full attributes so highlight works
    function render(filter){ tbody.innerHTML='';
      const list = db.assets.filter(a=>{ if(!filter) return true; const s=(a.id+' '+a.name+' '+a.type+' '+a.serial+' '+a.pic+' '+a.location+' '+a.notes+' '+(a.software||'')).toLowerCase(); return s.includes(filter.toLowerCase()); });
      list.forEach(a=>{
        const tr = document.createElement('tr');
        const fields = [a.id, a.name, a.type, a.serial||'', a.qty, a.software||'', a.pic||'', a.location||'', a.purchaseDate||'', a.warrantyUntil||'', a.qcStatus||''];
        fields.forEach((f, i)=>{
          const td = document.createElement('td');
          td.textContent = f;
          td.setAttribute('data-full', String(f));
          tr.appendChild(td);
        });
        // actions
        const tdActions = document.createElement('td'); tdActions.className='actions';
        const btnDetail = document.createElement('button'); btnDetail.className='btn-ghost'; btnDetail.innerHTML = '<span style="font-size:14px">üîç</span>'; btnDetail.setAttribute('data-action','detail'); btnDetail.setAttribute('data-id',a.id);
        const btnEdit = document.createElement('button'); btnEdit.className='btn-ghost'; btnEdit.textContent='Edit'; btnEdit.setAttribute('data-action','edit'); btnEdit.setAttribute('data-id',a.id);
        const btnDel = document.createElement('button'); btnDel.className='btn-ghost'; btnDel.textContent='Delete'; btnDel.setAttribute('data-action','del'); btnDel.setAttribute('data-id',a.id);
        tdActions.appendChild(btnDetail); tdActions.appendChild(btnEdit); tdActions.appendChild(btnDel);
        tr.appendChild(tdActions);
        tbody.appendChild(tr);
      });
      // total count by qty
      totalCountEl.textContent = db.assets.reduce((s,a)=> s + (Number(a.qty)||0), 0);
    }

    addBtn.addEventListener('click', ()=>{
      const quantity = Number(qtyEl.value||1);
      if(!nameEl.value.trim()) return alert('Nama barang tidak boleh kosong');
      const item = { id: genId(), name: nameEl.value.trim(), type: typeEl.value, serial: serialEl.value.trim(), qty: quantity, qcStatus: qcStatusEl.value, software: softwareEl.value.trim(), location: locEl.value.trim(), pic: picEl.value.trim(), purchaseDate: purchaseEl.value||'', warrantyUntil: warrantyEl.value||'', notes: notesEl.value.trim() };
      db.assets.push(item); save(); clearForm(); showToast('Item ditambahkan');
    });

    // table actions using event delegation
    tbody.addEventListener('click', e=>{
      const btn = e.target.closest('button'); if(!btn) return; const id = btn.getAttribute('data-id'); const action = btn.getAttribute('data-action');
      const idx = db.assets.findIndex(a=>a.id===id);
      if(action==='edit' && idx>=0){ const a=db.assets[idx]; editId=a.id; nameEl.value=a.name||''; typeEl.value=a.type||'Laptop'; serialEl.value=a.serial||''; qtyEl.value=a.qty||1; qcStatusEl.value=a.qcStatus||'Belum QC'; softwareEl.value=a.software||''; locEl.value=a.location||''; picEl.value=a.pic||''; purchaseEl.value=a.purchaseDate||''; warrantyEl.value=a.warrantyUntil||''; notesEl.value=a.notes||''; addBtn.disabled=true; updateBtn.textContent='Save Changes'; updateBtn.onclick = function(){ db.assets[idx] = { id:a.id, name:nameEl.value||a.name, type:typeEl.value, serial:serialEl.value, qty:Number(qtyEl.value||1), qcStatus:qcStatusEl.value, software:softwareEl.value, location:locEl.value, pic:picEl.value, purchaseDate:purchaseEl.value||'', warrantyUntil:warrantyEl.value||'', notes:notesEl.value||'' }; save(); clearForm(); updateBtn.onclick = resetAction; showToast('Item diperbarui'); }; window.scrollTo({top:0,behavior:'smooth'}); }
      else if(action==='del' && idx>=0){ if(confirm('Hapus item ini?')){ db.assets.splice(idx,1); save(); showToast('Item dihapus'); } }
    });

    function resetAction(){ clearForm(); updateBtn.onclick = resetAction; addBtn.disabled=false; }
    updateBtn.onclick = resetAction;

    // CSV / JSON helpers
    function csvSafe(s){ if(s==null) return ''; return '"'+String(s).replace(/"/g,'""')+'"'; }
    function toCsv(rows){ const heads=['id','name','type','serial','qty','software','pic','location','purchaseDate','warrantyUntil','qcStatus','notes']; const lines=[heads.join(',')]; rows.forEach(r=>{ const arr=[r.id, csvSafe(r.name), csvSafe(r.type), csvSafe(r.serial), r.qty, csvSafe(r.software), csvSafe(r.pic), csvSafe(r.location), r.purchaseDate||'', r.warrantyUntil||'', csvSafe(r.qcStatus), csvSafe(r.notes)]; lines.push(arr.join(',')); }); return lines.join('\n'); }

    exportCsvBtn.addEventListener('click', ()=>{ const csv = toCsv(db.assets); const blob = new Blob([csv], {type:'text/csv'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'assets_export_'+Date.now()+'.csv'; a.click(); URL.revokeObjectURL(a.href); showToast('CSV diexport'); });
    exportJsonBtn.addEventListener('click', ()=>{ const blob = new Blob([JSON.stringify(db,null,2)], {type:'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'assets_export_'+Date.now()+'.json'; a.click(); URL.revokeObjectURL(a.href); showToast('JSON diexport'); });

    importCsvBtn.addEventListener('click', ()=> csvFile.click()); importJsonBtn.addEventListener('click', ()=> jsonFile.click());

    csvFile.addEventListener('change', async e=>{ const f = e.target.files[0]; if(!f) return; const txt = await f.text(); parseCsv(txt); csvFile.value=''; });
    jsonFile.addEventListener('change', async e=>{ const f = e.target.files[0]; if(!f) return; try{ const txt = await f.text(); const data = JSON.parse(txt); const arr = Array.isArray(data.assets) ? data.assets : (Array.isArray(data) ? data : null); if(arr) { db.assets = db.assets.concat(arr); save(); showToast('Import JSON selesai'); } else alert('JSON tidak berisi array assets'); }catch(err){ alert('Gagal import JSON: '+err.message); } jsonFile.value=''; });

    // simple but safer CSV parser (handles quoted fields)
    function parseCsv(txt){ const lines = txt.split(/\r?\n/).filter(l=>l.trim()); if(lines.length<2) return alert('CSV kosong'); const heads = splitCsvLine(lines[0]); const arr=[]; for(let i=1;i<lines.length;i++){ const cols = splitCsvLine(lines[i]); if(cols.length<2) continue; const obj = { id: cols[0]||genId(), name: cols[1]||'Unknown', type: cols[2]||'Other', serial: cols[3]||'', qty: Number(cols[4]||1), software: cols[5]||'', pic: cols[6]||'', location: cols[7]||'', purchaseDate: cols[8]||'', warrantyUntil: cols[9]||'', qcStatus: cols[10]||'Belum QC', notes: cols[11]||'' }; arr.push(obj); }
      db.assets = db.assets.concat(arr); save(); showToast('Import CSV selesai, '+arr.length+' item ditambahkan'); }

    function splitCsvLine(line){ const res=[]; let cur=''; let inq=false; for(let i=0;i<line.length;i++){ const ch=line[i]; if(ch==='"'){ if(inq && line[i+1]==='"'){ cur+='"'; i++; continue; } inq=!inq; continue; } if(ch===',' && !inq){ res.push(cur); cur=''; } else cur+=ch; } res.push(cur); return res.map(s=>s.replace(/^"|"$/g,'')); }

    // Backup/Restore
    backupBtn.addEventListener('click', ()=>{ const blob = new Blob([JSON.stringify(db,null,2)], {type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='asset_backup_'+Date.now()+'.json'; a.click(); URL.revokeObjectURL(a.href); showToast('Backup tersimpan'); });
    restoreBtn.addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', async e=>{ const f = e.target.files[0]; if(!f) return; try{ const txt = await f.text(); const data = JSON.parse(txt); if(data && Array.isArray(data.assets)){ db = data; save(); alert('Restore berhasil'); } else if(data && data.assets && Array.isArray(data.assets)) { db = data; save(); alert('Restore berhasil'); } else alert('File JSON tidak valid untuk restore'); }catch(err){ alert('Gagal: '+err.message); } fileInput.value=''; });

    // search (debounced)
    globalSearch.addEventListener('input', debounce(e=>{ render(e.target.value); highlightSearch(e.target.value); }, 180));

    // QC UI
    const qcListEl = document.getElementById('qcList'); qcTemplate.forEach(it=>{ const el=document.createElement('label'); el.style.display='flex'; el.style.alignItems='center'; el.style.gap='8px'; const cb = document.createElement('input'); cb.type='checkbox'; cb.dataset.k=it.k; const span=document.createElement('span'); span.className='small'; span.textContent = it.l; el.appendChild(cb); el.appendChild(span); qcListEl.appendChild(el); });
    document.getElementById('saveQcBtn').addEventListener('click', ()=>{ const target = document.getElementById('qcTargetId').value.trim(); if(!target) return alert('Masukkan Asset ID pada field QC target.'); const idx = db.assets.findIndex(a=>a.id===target); if(idx<0) return alert('Asset ID tidak ditemukan.'); const checked = {}; qcListEl.querySelectorAll('input[type=checkbox]').forEach(cb=> checked[cb.dataset.k]=!!cb.checked); db.assets[idx].qc = checked; save(); showToast('QC tersimpan pada asset '+target); });
    document.getElementById('clearQcBtn').addEventListener('click', ()=> qcListEl.querySelectorAll('input[type=checkbox]').forEach(cb=>cb.checked=false));

    // Print
    document.getElementById('printBtn').addEventListener('click', ()=> window.print());

    // Excel with SheetJS (try/catch)
    document.getElementById('downloadExcelBtn').addEventListener('click', ()=>{ try{ if(typeof XLSX === 'undefined') throw new Error('SheetJS tidak tersedia'); const data = db.assets.map(a=>({ ID:a.id, Nama:a.name, Jenis:a.type, Serial:a.serial, Qty:a.qty, Software:a.software, PIC:a.pic, Lokasi:a.location, Purchase:a.purchaseDate, Warranty:a.warrantyUntil, QC:a.qcStatus })); const ws = XLSX.utils.json_to_sheet(data); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, 'Assets'); XLSX.writeFile(wb, 'Zeppelin_Asset_'+Date.now()+'.xlsx'); showToast('Excel diunduh'); }catch(e){ alert('Gagal generate Excel: '+e.message); } });

    // Dashboard
    function updateDashboard(){ const total = db.assets.reduce((s,a)=>s + (Number(a.qty)||0),0); const pcCount = db.assets.reduce((s,a)=> s + ((a.type==='Laptop' || a.type==='Desktop') ? Number(a.qty)||0 : 0), 0); let lulus=0,gagal=0,belum=0; db.assets.forEach(a=>{ if(!a.qcStatus || a.qcStatus==='Belum QC') belum += Number(a.qty)||0; else if(a.qcStatus==='Lulus QC') lulus += Number(a.qty)||0; else if(a.qcStatus==='Gagal QC') gagal += Number(a.qty)||0; }); kpiTotal.textContent = total; kpiPC.textContent = pcCount; kpiQC.textContent = `L:${lulus} ‚Ä¢ G:${gagal} ‚Ä¢ B:${belum}`;
      // charts
      const categories = {}; db.assets.forEach(a=> categories[a.type] = (categories[a.type]||0) + (Number(a.qty)||0)); const labels = Object.keys(categories); const values = labels.map(l=>categories[l]); try{ if(window.Chart){ if(barChart){ barChart.data.labels = labels; barChart.data.datasets[0].data = values; barChart.update(); } else { barChart = new Chart(barCanvas, { type:'bar', data:{ labels: labels.length?labels:['-'], datasets:[{ label:'Jumlah', data: values.length?values:[0], backgroundColor:'#ff7a18' }]}, options:{responsive:true,plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}} }); } const pieData = [lulus,gagal,belum]; if(pieChart){ pieChart.data.datasets[0].data = pieData; pieChart.update(); } else { pieChart = new Chart(pieCanvas, { type:'pie', data:{ labels:['Lulus','Gagal','Belum'], datasets:[{ data: pieData, backgroundColor:['#1db954','#ff4d4f','#ffd166'] }]}, options:{responsive:true,plugins:{legend:{position:'bottom'}}} }); } } }catch(e){ /* ignore chart errors */ }
    }

    // expose minimal API for external scripts
    return { load, render, save, getDB: ()=>db, updateDashboard, clearForm, genId };
  })();

  // attach to window for other scripts and debugging
  window.ZeppelinApp = ZeppelinApp;
  window.load = ZeppelinApp.load; window.render = ZeppelinApp.render; // expose legacy names

  // init
  ZeppelinApp.load(); ZeppelinApp.render(); ZeppelinApp.updateDashboard();

  // small toast helper
  function showToast(txt){ let t = document.getElementById('toastMsg'); if(!t){ t=document.createElement('div'); t.id='toastMsg'; t.style.position='fixed'; t.style.right='18px'; t.style.bottom='18px'; t.style.background='rgba(0,0,0,0.6)'; t.style.color='#fff'; t.style.padding='8px 12px'; t.style.borderRadius='8px'; t.style.boxShadow='0 6px 18px rgba(0,0,0,0.4)'; document.body.appendChild(t); } t.textContent=txt; t.style.opacity='1'; setTimeout(()=> t.style.opacity='0',2200); }

  // expose showToast globally for reuse
  window.showToast = showToast;

})();
</script>
<script>
/* Additional features: filters, sort, live highlight, theme toggle, auto-backup, print report
   This script now uses the exposed window.render / window.load and the global ASSET_STORAGE_KEY
*/
(function(){
  const STORAGE_KEY = window.ASSET_STORAGE_KEY || 'asset_manager_final';
  function $(sel){ return document.querySelector(sel); }
  function $all(sel){ return Array.from(document.querySelectorAll(sel)); }

  function refreshFilterOptions(){ const assets = (JSON.parse(localStorage.getItem(STORAGE_KEY) || '{"assets":[]}').assets)||[]; const typeSet=new Set(); const locSet=new Set(); const picSet=new Set(); assets.forEach(a=>{ if(a.type) typeSet.add(a.type); if(a.location) locSet.add(a.location); if(a.pic) picSet.add(a.pic); }); const selType=$('#filterType'); const selLoc=$('#filterLoc'); const selPic=$('#filterPic'); if(!selType||!selLoc||!selPic) return; [selType,selLoc,selPic].forEach(s=>{ while(s.options.length>1) s.remove(1); }); typeSet.forEach(v=> selType.add(new Option(v,v))); locSet.forEach(v=> selLoc.add(new Option(v,v))); picSet.forEach(v=> selPic.add(new Option(v,v))); }

  function applyFiltersAndSearch(){ const search = ($('#globalSearch') && $('#globalSearch').value) || ''; const fType = ($('#filterType') && $('#filterType').value) || ''; const fQc = ($('#filterQc') && $('#filterQc').value) || ''; const fLoc = ($('#filterLoc') && $('#filterLoc').value) || ''; const fPic = ($('#filterPic') && $('#filterPic').value) || ''; if(typeof window.render === 'function'){ // use render for text search then do table row hiding for other filters
      window.render(search);
      const rows = $all('#assetTable tbody tr'); rows.forEach(r=>{ const t = r; let show = true; if(fType && !t.children[2].textContent.includes(fType)) show=false; if(fQc && !t.children[10].textContent.includes(fQc)) show=false; if(fLoc && !t.children[7].textContent.includes(fLoc)) show=false; if(fPic && !t.children[6].textContent.includes(fPic)) show=false; t.style.display = show ? '' : 'none'; });
    } else { // fallback
      const rows = $all('#assetTable tbody tr'); rows.forEach(r=>{ const txt = r.textContent.toLowerCase(); let show = true; if(search && !txt.includes(search.toLowerCase())) show = false; if(fType && !r.cells[2].textContent.includes(fType)) show = false; if(fQc && !r.cells[10].textContent.includes(fQc)) show = false; if(fLoc && !r.cells[7].textContent.includes(fLoc)) show = false; if(fPic && !r.cells[6].textContent.includes(fPic)) show = false; r.style.display = show ? '' : 'none'; }); }
      highlightSearch(search);
  }

  // highlightSearch: only operate on text cells (avoid actions)
  function highlightSearch(q){ const tbody = document.querySelector('#assetTable tbody'); if(!tbody) return; const ql=(q||'').trim().toLowerCase(); tbody.querySelectorAll('tr').forEach(tr=>{ Array.from(tr.children).forEach((td, idx)=>{ if(idx === tr.children.length-1) return; const text = td.getAttribute('data-full') || td.textContent; if(ql && text.toLowerCase().includes(ql)){ const regex = new RegExp('('+escapeRegex(ql)+')','gi'); td.innerHTML = window.escapeHtml(text).replace(regex,'<mark>$1</mark>'); } else { td.textContent = text; } }); }); }
  function escapeRegex(s){ return s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'); }

  function enableSorting(){ const headers = $all('#assetTable thead th'); headers.forEach((th, idx)=>{ if(idx === headers.length-1) return; th.style.cursor='pointer'; th.addEventListener('click', ()=>{ const tbody = document.querySelector('#assetTable tbody'); if(!tbody) return; const rows = Array.from(tbody.querySelectorAll('tr')).filter(r=>r.style.display !== 'none'); const asc = th.dataset.asc === 'true' ? false : true; th.dataset.asc = asc; rows.sort((a,b)=>{ const aText = a.children[idx].textContent.trim().toLowerCase(); const bText = b.children[idx].textContent.trim().toLowerCase(); if(!isNaN(parseFloat(aText)) && !isNaN(parseFloat(bText))){ return asc ? (parseFloat(aText) - parseFloat(bText)) : (parseFloat(bText) - parseFloat(aText)); } return asc ? aText.localeCompare(bText) : bText.localeCompare(aText); }); rows.forEach(r=>tbody.appendChild(r)); }); }); }

  function initTheme(){ const btn = $('#themeToggle'); if(!btn) return; const current = localStorage.getItem('zepp_theme') || 'dark'; document.documentElement.setAttribute('data-theme', current); applyTheme(current); btn.addEventListener('click', ()=>{ const t = (localStorage.getItem('zepp_theme')||'dark') === 'dark' ? 'light' : 'dark'; localStorage.setItem('zepp_theme', t); applyTheme(t); }); }
  function applyTheme(t){ if(t==='light'){ document.documentElement.style.setProperty('--bg','#f7fafc'); document.documentElement.style.setProperty('--card','#ffffff'); document.documentElement.style.setProperty('--muted','#6b7280'); document.documentElement.style.setProperty('--accent','#0ea5a4'); document.documentElement.style.setProperty('--border','rgba(2,6,23,0.06)'); document.body.style.color = getComputedStyle(document.documentElement).getPropertyValue('color'); } else { document.documentElement.style.removeProperty('--bg'); document.documentElement.style.removeProperty('--card'); document.documentElement.style.removeProperty('--muted'); document.documentElement.style.removeProperty('--accent'); document.documentElement.style.removeProperty('--border'); document.body.style.color = ''; } }

  // auto backup polling
  function hookSaveEvents(){ let last = localStorage.getItem(STORAGE_KEY); setInterval(()=>{ const cur = localStorage.getItem(STORAGE_KEY); if(cur && cur !== last){ // store backup
        const payload = { ts: Date.now(), data: JSON.parse(cur) }; localStorage.setItem(STORAGE_KEY + '_backup', JSON.stringify(payload)); refreshFilterOptions(); last = cur; window.showToast && window.showToast('Backup auto tersimpan'); } }, 2000); }

  function attachPrintReport(){ const btn = $('#printReportBtn'); if(!btn) return; btn.addEventListener('click', ()=>{ const db = (JSON.parse(localStorage.getItem(STORAGE_KEY) || '{"assets":[]}')); const assets = db.assets || []; const total = assets.reduce((s,a)=> s + (Number(a.qty)||0), 0); const pcCount = assets.reduce((s,a)=> s + ((a.type==='Laptop' || a.type==='Desktop') ? Number(a.qty)||0 : 0), 0); const date = new Date().toLocaleString(); let html = `<!doctype html><html><head><meta charset="utf-8"><title>Laporan Asset</title><style>body{font-family:Inter,Arial,Helvetica,sans-serif;color:#0b1220;margin:24px}.header{display:flex;align-items:center;gap:16px;margin-bottom:12px}.logo{width:56px;height:56px;border-radius:8px;background:#ff7a18;display:flex;align-items:center;justify-content:center;font-weight:800;color:#08101a}h1{margin:0;font-size:20px}.muted{color:#6b7280;font-size:13px}.kpi-row{display:flex;gap:12px;margin:12px 0}.kpi{padding:10px;border-radius:8px;border:1px solid #e6e9ef;min-width:160px;text-align:center}table{width:100%;border-collapse:collapse;margin-top:12px;font-size:12px}th,td{padding:8px;border:1px solid #eee;text-align:left}</style></head><body>`; html += `<div class="header"><div class="logo">Z</div><div><h1>Laporan Asset ‚Äî Zeppelin</h1><div class="muted">Dicetak: ${date}</div></div></div>`; html += `<div class="kpi-row"><div class="kpi"><strong>Total Asset</strong><div>${total}</div></div><div class="kpi"><strong>PC (Laptop/Desktop)</strong><div>${pcCount}</div></div></div>`; html += `<table><thead><tr><th>ID</th><th>Nama</th><th>Jenis</th><th>Serial</th><th>Qty</th><th>PIC</th><th>Lokasi</th><th>QC</th></tr></thead><tbody>`; assets.forEach(a=>{ html += `<tr><td>${window.escapeHtml(a.id)}</td><td>${window.escapeHtml(a.name)}</td><td>${window.escapeHtml(a.type)}</td><td>${window.escapeHtml(a.serial||'')}</td><td>${a.qty}</td><td>${window.escapeHtml(a.pic||'')}</td><td>${window.escapeHtml(a.location||'')}</td><td>${window.escapeHtml(a.qcStatus||'')}</td></tr>`; }); html += `</tbody></table></body></html>`; const win = window.open('','_blank','width=900,height=700'); if(win){ win.document.write(html); win.document.close(); setTimeout(()=> win.print(), 500); } else alert('Pop-up blocked. Izinkan pop-up untuk mencetak laporan.'); }); }

  function attachFilterHandlers(){ ['#globalSearch','#filterType','#filterQc','#filterLoc','#filterPic'].forEach(id=>{ const el=$(id); if(el) { el.addEventListener('input', ()=> applyFiltersAndSearch()); el.addEventListener('change', ()=> applyFiltersAndSearch()); } }); }

  document.addEventListener('DOMContentLoaded', ()=>{ if(typeof window.load === 'function') window.load(); if(typeof window.render === 'function') window.render(); refreshFilterOptions(); attachFilterHandlers(); enableSorting(); initTheme(); hookSaveEvents(); attachPrintReport(); const rb = document.getElementById('restoreBackupBtn'); if(rb) rb.addEventListener('click', ()=>{ try{ const bk = JSON.parse(localStorage.getItem(STORAGE_KEY + '_backup')||'null'); if(!bk) return alert('Tidak ada backup terakhir.'); localStorage.setItem(STORAGE_KEY, JSON.stringify(bk.data)); window.load && window.load(); window.render && window.render(); window.showToast && window.showToast('Backup dipulihkan'); }catch(e){ alert('Gagal restore: '+e.message); } }); });

})();
</script>

<!-- Detail Modal (table-style) -->
<div id="detailModalOverlay" style="display:none; position:fixed; inset:0; background:rgba(2,6,23,0.6); align-items:center; justify-content:center; z-index:9999;">
<div aria-modal="true" id="detailModal" role="dialog" style="width:min(680px,95%); background:var(--card); border-radius:14px; padding:18px; border:1px solid rgba(255,255,255,0.04); box-shadow:0 12px 40px rgba(2,6,23,0.7);">
<div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:8px">
<h4 style="margin:0;color:var(--accent)">Detail Perangkat</h4>
<div style="display:flex;gap:8px">
<button class="btn-ghost" id="copyIdBtn" title="Salin ID">Salin ID</button>
<button class="btn" id="closeDetailBtn">Tutup</button>
</div>
</div>
<div style="overflow:auto; max-height:60vh;">
<table style="width:100%; border-collapse:collapse; font-size:14px;">
<tbody id="detailTableBody"></tbody>
</table>
</div>
<div style="display:flex;justify-content:flex-end;margin-top:12px;gap:8px">
<button class="btn-ghost" id="editFromDetailBtn">Edit Item</button>
<button class="btn" id="closeDetailBtn2">Tutup</button>
</div>
</div>
</div>

<script>
(function(){
  function $(sel){ return document.querySelector(sel); }
  const overlay = $('#detailModalOverlay');
  const tbody = document.getElementById('detailTableBody');
  const copyBtn = document.getElementById('copyIdBtn');
  const closeBtn = document.getElementById('closeDetailBtn');
  const closeBtn2 = document.getElementById('closeDetailBtn2');
  const editBtn = document.getElementById('editFromDetailBtn');
  document.addEventListener('click', function(e){
    const btn = e.target.closest('button[data-action="detail"]');
    if(!btn) return;
    const id = btn.getAttribute('data-id');
    const db = (JSON.parse(localStorage.getItem(window.ASSET_STORAGE_KEY)||'{"assets":[]}')).assets||[];
    const a = db.find(x=>x.id===id);
    if(!a) return alert('Data tidak ditemukan');
    const rows = [
      ['ID', a.id],
      ['Nama', a.name || '-'],
      ['Jenis', a.type || '-'],
      ['Serial', a.serial || '-'],
      ['Qty', a.qty || '-'],
      ['Software', a.software || '-'],
      ['PIC', a.pic || '-'],
      ['Lokasi', a.location || '-'],
      ['Tanggal Pembelian', a.purchaseDate || '-'],
      ['Warranty Until', a.warrantyUntil || '-'],
      ['Status QC', a.qcStatus || '-'],
      ['Keterangan', a.notes || '-']
    ];
    tbody.innerHTML = rows.map(r=>`<tr><td style="padding:8px 10px; color:var(--muted); width:40%; border-bottom:1px solid rgba(255,255,255,0.04)"><strong>${r[0]}</strong></td><td style="padding:8px 10px; border-bottom:1px solid rgba(255,255,255,0.04)">${r[1]}</td></tr>`).join('');
    overlay.style.display = 'flex';
    // wire edit
    editBtn.onclick = function(){ overlay.style.display='none'; const editBtnEl = document.querySelector('#assetTable button[data-action="edit"][data-id="'+id+'"]'); if(editBtnEl) editBtnEl.click(); };
    copyBtn.onclick = function(){ try{ navigator.clipboard.writeText(a.id); window.showToast && window.showToast('ID disalin'); }catch(e){ alert('Gagal salin'); } };
  });
  closeBtn && closeBtn.addEventListener('click', ()=> overlay.style.display='none');
  closeBtn2 && closeBtn2.addEventListener('click', ()=> overlay.style.display='none');
  overlay && overlay.addEventListener('click', function(ev){ if(ev.target === overlay) overlay.style.display='none'; });
})();
</script>
</body>
</html>